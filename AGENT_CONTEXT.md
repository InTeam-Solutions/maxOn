# –ö–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–æ–µ–∫—Ç–∞ maxOn –¥–ª—è AI-–∞–≥–µ–Ω—Ç–∞

## üéØ –û –ø—Ä–æ–µ–∫—Ç–µ

**maxOn** ‚Äî —ç—Ç–æ AI-–∫–æ—É—á –∏ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –Ω–∞–º–µ—Ä–µ–Ω–∏–π –¥–ª—è –Ω–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–∞ MAX. Telegram-–±–æ—Ç —Å –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–º–æ–≥–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –¥–æ—Å—Ç–∏–≥–∞—Ç—å —Ü–µ–ª–µ–π —á–µ—Ä–µ–∑ —É–º–Ω—É—é –¥–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—é, SMART-–∞–Ω–∞–ª–∏–∑ –∏ —Å–∏—Å—Ç–µ–º—É –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π.

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

### –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫
- **Backend**: Python 3.11, FastAPI, SQLAlchemy
- **Bot Framework**: Aiogram 3.13.1 (Telegram)
- **AI**: OpenAI GPT-4o —á–µ—Ä–µ–∑ ProxyAPI
- **Database**: PostgreSQL 16
- **Cache**: Redis 7
- **Task Scheduler**: APScheduler 3.10.4
- **Deployment**: Docker Compose

### –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Telegram Bot   ‚îÇ  ‚Üê –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É–µ—Ç –∑–¥–µ—Å—å
‚îÇ  (API Gateway)  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ Orchestrator ‚îÇ  ‚Üê –ö–æ–æ—Ä–¥–∏–Ω–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏
    ‚îî‚îÄ‚î¨‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îò
      ‚îÇ  ‚îÇ    ‚îÇ
  ‚îå‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îê
  ‚îÇ Context ‚îÇ LLM ‚îÇ Core ‚îÇ Worker ‚îÇ  ‚Üê –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã
  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
          ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ PostgreSQL ‚îÇ  ‚Üê –ï–¥–∏–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
    ‚îÇ   Redis    ‚îÇ  ‚Üê –ö–µ—à –∏ —Å–µ—Å—Å–∏–∏
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 6 –æ—Å–Ω–æ–≤–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤:

1. **API Gateway** (Telegram Bot) - `/services/api-gateway/`
   - –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
   - Rich HTML —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Å InlineKeyboards
   - –ö–æ–º–∞–Ω–¥—ã: `/start`, `/goals`, `/events`, `/settings`
   - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏ (editing, goal_clarification, etc.)
   - –§–∞–π–ª: `app/main.py` (3700+ —Å—Ç—Ä–æ–∫)

2. **Orchestrator** (:8001) - `/services/orchestrator/`
   - –ö–æ–æ—Ä–¥–∏–Ω–∏—Ä—É–µ—Ç —Ä–∞–±–æ—Ç—É –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏
   - State Machine –¥–ª—è –º–Ω–æ–≥–æ—à–∞–≥–æ–≤—ã—Ö –¥–∏–∞–ª–æ–≥–æ–≤
   - –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç SMART-–∞–Ω–∞–ª–∏–∑ —Ü–µ–ª–µ–π
   - –ü–ª–∞–Ω–∏—Ä—É–µ—Ç —à–∞–≥–∏ –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä–µ
   - –§–∞–π–ª: `app/main.py` (679 —Å—Ç—Ä–æ–∫)

3. **Core Service** (:8004) - `/services/core/`
   - CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è –≤—Å–µ—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π
   - –ú–æ–¥–µ–ª–∏: Event, Goal, Step, Product, CartItem, User
   - REST API —Å Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π
   - –§–∞–π–ª: `app/main.py` (734 —Å—Ç—Ä–æ–∫–∏)

4. **Context Service** (:8002) - `/services/context/`
   - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–µ–π –¥–∏–∞–ª–æ–≥–æ–≤
   - –ü—Ä–æ—Ñ–∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å timezone
   - –°–µ—Å—Å–∏–∏ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è
   - –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–ª—è LLM

5. **LLM Service** (:8003) - `/services/llm/`
   - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å OpenAI GPT-4o
   - –ü–∞—Ä—Å–∏–Ω–≥ natural language ‚Üí structured JSON
   - Jinja2 –ø—Ä–æ–º–ø—Ç—ã —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
   - SMART-–∞–Ω–∞–ª–∏–∑ —Ü–µ–ª–µ–π
   - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —à–∞–≥–æ–≤ (goal_coach)

6. **Worker Service** (:8005) - `/services/worker/` ‚≠ê NEW
   - APScheduler –¥–ª—è —Ñ–æ–Ω–æ–≤—ã—Ö –∑–∞–¥–∞—á
   - 4 —Ç–∏–ø–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:
     - Event reminders (–∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É)
     - Goal deadline warnings (–µ–∂–µ–¥–Ω–µ–≤–Ω–æ 9:00)
     - Unfinished step reminders (–µ–∂–µ–¥–Ω–µ–≤–Ω–æ 20:00)
     - Motivational messages (–µ–∂–µ–¥–Ω–µ–≤–Ω–æ 8:00)
   - –ü—Ä—è–º–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ Telegram Bot API

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### Core Service Tables:

```sql
-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (NEW)
users (
  user_id VARCHAR(64) PRIMARY KEY,
  chat_id VARCHAR(64) NOT NULL,
  timezone VARCHAR(64) DEFAULT 'Europe/Moscow',
  notification_enabled BOOLEAN DEFAULT TRUE,
  event_reminders_enabled BOOLEAN DEFAULT TRUE,
  goal_deadline_warnings_enabled BOOLEAN DEFAULT TRUE,
  step_reminders_enabled BOOLEAN DEFAULT TRUE,
  motivational_messages_enabled BOOLEAN DEFAULT TRUE
)

-- –°–æ–±—ã—Ç–∏—è —Å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è–º–∏
events (
  id SERIAL PRIMARY KEY,
  user_id VARCHAR(64),
  title VARCHAR(255),
  date DATE,
  time TIME,
  duration_minutes INT,
  repeat VARCHAR(64),
  notes TEXT,
  event_type VARCHAR(32) DEFAULT 'user',
  linked_step_id INT,
  linked_goal_id INT,
  reminder_minutes_before INT DEFAULT 15,  -- NEW
  reminder_enabled BOOLEAN DEFAULT TRUE     -- NEW
)

-- –¶–µ–ª–∏
goals (
  id SERIAL PRIMARY KEY,
  user_id VARCHAR(64),
  title VARCHAR(255),
  description TEXT,
  status VARCHAR(32) DEFAULT 'active',
  progress_percent FLOAT DEFAULT 0,
  target_date DATE,
  target_deadline DATE,
  is_scheduled BOOLEAN DEFAULT FALSE
)

-- –®–∞–≥–∏ —Ü–µ–ª–µ–π
steps (
  id SERIAL PRIMARY KEY,
  goal_id INT REFERENCES goals(id),
  title VARCHAR(255),
  order INT,
  status VARCHAR(32) DEFAULT 'pending',
  estimated_hours FLOAT,
  completed_at TIMESTAMP,
  planned_date DATE,
  planned_time TIME,
  duration_minutes INT,
  linked_event_id INT
)
```

### Context Service Tables:
- `user_profiles` - —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª–∏
- `conversation_messages` - –∏—Å—Ç–æ—Ä–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π
- `session_states` - —Ç–µ–∫—É—â–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –¥–∏–∞–ª–æ–≥–∞

## üîë –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –∫–æ–¥–æ–≤–æ–π –±–∞–∑—ã

### 1. Intent System (LLM Service)

–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –∏–Ω—Ç–µ–Ω—Ç—ã –≤ `services/llm/app/prompts/system.py`:
- `small_talk` - –æ–±—ã—á–Ω—ã–π —Ä–∞–∑–≥–æ–≤–æ—Ä
- `event.search` - –ø–æ–∏—Å–∫ —Å–æ–±—ã—Ç–∏–π
- `event.mutate` - —Å–æ–∑–¥–∞–Ω–∏–µ/–∏–∑–º–µ–Ω–µ–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π
- `goal.search` - –ø–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ —Ü–µ–ª–∏
- `goal.create` - —Å–æ–∑–¥–∞—Ç—å —Ü–µ–ª—å —Å —à–∞–≥–∞–º–∏
- `goal.delete` - —É–¥–∞–ª–∏—Ç—å —Ü–µ–ª—å
- `goal.query` - –ø–æ–∫–∞–∑–∞—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Ü–µ–ª–∏
- `goal.update_step` - –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å —à–∞–≥–∞
- `goal.add_step` - –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —à–∞–≥
- `goal.delete_step` - —É–¥–∞–ª–∏—Ç—å —à–∞–≥
- `product.search` - –ø–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤ (–±—É–¥—É—â–µ–µ)

### 2. State Machine (Orchestrator)

–°–æ—Å—Ç–æ—è–Ω–∏—è –¥–∏–∞–ª–æ–≥–∞:
```python
class DialogState(str, Enum):
    IDLE = "idle"
    GOAL_CLARIFICATION = "goal_clarification"
    GOAL_EDITING = "goal_editing"
    EVENT_EDIT_* = "event_edit_title", "event_edit_date", etc.
    GOAL_EDIT_* = "goal_edit_title", "goal_edit_deadline", etc.
    STEP_EDIT_* = "step_edit_title", etc.
```

### 3. Telegram UI Patterns (API Gateway)

**–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é:**
```python
[üéØ –ú–æ–∏ —Ü–µ–ª–∏] [üìÖ –ö–∞–ª–µ–Ω–¥–∞—Ä—å]
[‚ûï –ù–æ–≤–∞—è —Ü–µ–ª—å] [‚ûï –°–æ–±—ã—Ç–∏–µ]
```

**–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ü–µ–ª—è–º–∏:**
```python
üéØ [–ù–∞–∑–≤–∞–Ω–∏–µ —Ü–µ–ª–∏] ‚úÖ 75%
‚ñ∂ [–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –¥–µ—Ç–∞–ª–∏]
‚ñ∂ [–£–¥–∞–ª–∏—Ç—å —Ü–µ–ª—å]
```

**–ö–∞–ª–µ–Ω–¥–∞—Ä—å (grouped by date):**
```markdown
‚îÅ‚îÅ‚îÅ –ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫, 11.11 ‚îÅ‚îÅ‚îÅ
‚è∞ 15:00  –í—Å—Ç—Ä–µ—á–∞ —Å –∫–ª–∏–µ–Ω—Ç–æ–º (2—á)

‚îÅ‚îÅ‚îÅ –í—Ç–æ—Ä–Ω–∏–∫, 12.11 ‚îÅ‚îÅ‚îÅ
‚è∞ 10:00  –°–æ–∑–≤–æ–Ω –∫–æ–º–∞–Ω–¥—ã (1—á)
```

### 4. SMART Goal Analysis Flow

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ü–µ–ª—å
2. LLM –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ø–æ SMART (Specific, Measurable, Achievable, Relevant, Time-bound)
3. Orchestrator –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç —É–ª—É—á—à–µ–Ω–∏—è
4. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç/—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç
5. LLM –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø–æ—à–∞–≥–æ–≤—ã–π –ø–ª–∞–Ω (goal_coach)
6. –®–∞–≥–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–ª–∞–Ω–∏—Ä—É—é—Ç—Å—è –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä–µ

### 5. Notification System (Worker)

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**
- APScheduler —Å Redis JobStore
- –ü—Ä—è–º—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ PostgreSQL
- –û—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ Aiogram Bot
- Timezone-aware scheduling

**–ó–∞–¥–∞—á–∏:**
```python
# Event Reminders (interval: 1 minute)
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç: event_datetime - reminder_minutes_before ‚âà NOW
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç: –î–µ—Ç–∞–ª–∏ —Å–æ–±—ã—Ç–∏—è + –≤—Ä–µ–º—è –¥–æ –Ω–∞—á–∞–ª–∞

# Goal Deadlines (cron: 9:00)
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç: target_date in [today + 7d, 3d, 1d, 0d]
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç: –ü—Ä–æ–≥—Ä–µ—Å—Å + –¥–µ–¥–ª–∞–π–Ω + –º–æ—Ç–∏–≤–∞—Ü–∏—è

# Step Reminders (cron: 20:00)
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç: status='in_progress' AND planned_date < today
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç: –°–ø–∏—Å–æ–∫ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö —à–∞–≥–æ–≤ –ø–æ —Ü–µ–ª—è–º

# Motivational (cron: 8:00)
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç: active_goals count > 0
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç: –°–ª—É—á–∞–π–Ω–∞—è –º–æ—Ç–∏–≤–∞—Ü–∏—è + —Ç–µ–∫—É—â–∏–µ —Ü–µ–ª–∏
```

## üöÄ –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã

### –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞
```bash
cd /Users/asgatakmaev/Desktop/business/maxOn

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å—ë
docker compose up -d

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å—ã
docker compose ps

# –õ–æ–≥–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
docker compose logs -f worker
docker compose logs -f api-gateway
docker compose logs -f orchestrator

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
docker compose build <service>
docker compose up -d <service>
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ Worker
```bash
# –°–ø–∏—Å–æ–∫ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∑–∞–¥–∞—á
curl http://localhost:8005/jobs | python3 -m json.tool

# Health check
curl http://localhost:8005/health
```

### –†–∞–±–æ—Ç–∞ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ PostgreSQL
docker compose exec postgres psql -U initio -d initio

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
SELECT * FROM users;

# –°–æ–±—ã—Ç–∏—è —Å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è–º–∏
SELECT id, title, date, time, reminder_minutes_before, reminder_enabled
FROM events
WHERE reminder_enabled = true;
```

## üîß –¢–∏–ø–∏—á–Ω—ã–µ –∑–∞–¥–∞—á–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–µ –ø–æ–ª–µ –≤ –º–æ–¥–µ–ª—å

1. **–û–±–Ω–æ–≤–∏—Ç—å SQLAlchemy –º–æ–¥–µ–ª—å** (–Ω–∞–ø—Ä. `services/core/app/models/event.py`)
2. **–û–±–Ω–æ–≤–∏—Ç—å Pydantic —Å—Ö–µ–º—ã** (`shared/schemas/events.py`)
3. **–û–±–Ω–æ–≤–∏—Ç—å CRUD –º–µ—Ç–æ–¥—ã** (`services/core/app/services/events.py`)
4. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å Core:** `docker compose restart core`

### –ò–∑–º–µ–Ω–∏—Ç—å LLM –ø—Ä–æ–º–ø—Ç—ã

–§–∞–π–ª—ã –ø—Ä–æ–º–ø—Ç–æ–≤ (Jinja2):
- `services/llm/app/prompts/system.py` - –æ—Å–Ω–æ–≤–Ω–æ–π –ø–∞—Ä—Å–∏–Ω–≥
- `services/llm/app/prompts/summarizer.py` - —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤
- `services/llm/app/prompts/goal_coach.py` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —à–∞–≥–æ–≤

–ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π: `docker compose restart llm`

### –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Ç–∏–ø —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

1. –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `services/worker/app/tasks/new_task.py`
2. –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –º–æ–¥–µ–ª–∏: `from core_models.event import Event`
3. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ `services/worker/app/scheduler.py`
4. –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å: `docker compose build worker && docker compose up -d worker`

### –î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–∞–Ω–¥—É –≤ –±–æ—Ç–∞

–í `services/api-gateway/app/main.py`:
```python
@dp.message(Command("newcommand"))
async def cmd_newcommand(message: Message):
    user_id = str(message.from_user.id)
    # –≤–∞—à–∞ –ª–æ–≥–∏–∫–∞
```

## üìù –í–∞–∂–Ω—ã–µ —Ñ–∞–π–ª—ã –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –∏–∑—É—á–∏—Ç—å:
1. **CLAUDE.md** - –ø–æ–ª–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –ø–∞—Ç—Ç–µ—Ä–Ω—ã
2. **docker-compose.yml** - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
3. **services/api-gateway/app/main.py** - –≥–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª –±–æ—Ç–∞
4. **services/orchestrator/app/main.py** - –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è
5. **services/worker/app/scheduler.py** - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–∞–¥–∞—á
6. **shared/schemas/** - –≤—Å–µ Pydantic –º–æ–¥–µ–ª–∏

### –ö–ª—é—á–µ–≤—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã:

**Database Session Pattern:**
```python
from shared.database import get_db

db = get_db()
with db.session_ctx() as session:
    # –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –ë–î
    session.commit()  # auto-commit
```

**HTTP Communication:**
```python
import httpx

http_client = httpx.AsyncClient(timeout=30.0)
response = await http_client.get(f"{CORE_SERVICE_URL}/api/users/{user_id}")
```

**Telegram Message Sending:**
```python
await bot.send_message(
    chat_id=chat_id,
    text=formatted_message,
    parse_mode="HTML",
    reply_markup=keyboard
)
```

## üêõ –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### Worker –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
- **–ü—Ä–æ–±–ª–µ–º–∞:** ModuleNotFoundError –¥–ª—è core_models
- **–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å Dockerfile, –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å—Ç—Ä–æ–∫–∞:
  ```dockerfile
  COPY services/core/app/models /app/core_models
  ```

### .env –Ω–µ –ø–æ–¥—Ç—è–≥–∏–≤–∞–µ—Ç—Å—è
- **–ü—Ä–æ–±–ª–µ–º–∞:** Environment variables not found
- **–†–µ—à–µ–Ω–∏–µ:** –£–±–µ–¥–∏—Å—å —á—Ç–æ `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç:
  ```
  TELEGRAM_BOT_TOKEN=...
  OPENAI_API_KEY=...
  POSTGRES_PASSWORD=...
  ```

### –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–∞–¥–∞–µ—Ç –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
docker compose logs <service>

# –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å —Å –Ω—É–ª—è
docker compose down -v  # –û–°–¢–û–†–û–ñ–ù–û: —É–¥–∞–ª–∏—Ç –¥–∞–Ω–Ω—ã–µ!
docker compose build --no-cache
docker compose up -d
```

### –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è
1. –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ user —Å–æ–∑–¥–∞–Ω: `curl http://localhost:8004/api/users/<user_id>`
2. –ü—Ä–æ–≤–µ—Ä—å notification_enabled: –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å true
3. –ü—Ä–æ–≤–µ—Ä—å chat_id: –¥–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å Telegram user_id
4. –ü—Ä–æ–≤–µ—Ä—å Worker –∑–∞–¥–∞—á–∏: `curl http://localhost:8005/jobs`

## üéØ –¶–µ–ª–∏ –ø—Ä–æ–µ–∫—Ç–∞ (Roadmap)

### –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ ‚úÖ
- –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- Telegram bot —Å rich UI
- SMART –∞–Ω–∞–ª–∏–∑ —Ü–µ–ª–µ–π
- –ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è —à–∞–≥–æ–≤
- –ö–∞–ª–µ–Ω–¥–∞—Ä—å —Å –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–æ–π
- –†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ inline buttons
- –°–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (4 —Ç–∏–ø–∞)
- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### –í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ üöß
- [ ] Product Search - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–∞–º–∏
- [ ] Recurring Events - –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è —Å–æ–±—ã—Ç–∏—è
- [ ] Integration Tests
- [ ] **–ê–¥–∞–ø—Ç–∞—Ü–∏—è –¥–ª—è MAX –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–∞** ‚≠ê
- [ ] Deploy –Ω–∞ Kubernetes

## üí° –ü–æ–¥—Å–∫–∞–∑–∫–∏ –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–π —Ä–∞–±–æ—Ç—ã

1. **–í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–π –ª–æ–≥–∏** –ø–µ—Ä–µ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏: `docker compose logs -f`
2. **–ò—Å–ø–æ–ª—å–∑—É–π Swagger UI** –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è API: http://localhost:8004/docs
3. **–ò–∑—É—á–∏ CLAUDE.md** - —Ç–∞–º –¥–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –≤—Å–µ—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤
4. **–¢–µ—Å—Ç–∏—Ä—É–π –ª–æ–∫–∞–ª—å–Ω–æ** –ø–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º: `docker compose up -d`
5. **–ù–µ –∫–æ–º–º–∏—Ç—å .env** - –æ–Ω –≤ .gitignore
6. **Worker —Ç—Ä–µ–±—É–µ—Ç –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∏** –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ tasks/
7. **Jinja2 –ø—Ä–æ–º–ø—Ç—ã** –∏—Å–ø–æ–ª—å–∑—É—é—Ç –¥–≤–æ–π–Ω—ã–µ —Ñ–∏–≥—É—Ä–Ω—ã–µ —Å–∫–æ–±–∫–∏: `{{ variable }}`
8. **Telegram HTML** –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç: `<b>`, `<i>`, `<code>`, `<pre>`
9. **User ID** –≤ Telegram = Chat ID –¥–ª—è –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö —á–∞—Ç–æ–≤
10. **Redis** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è: –∫–µ—à–∞ (DB 0-3) –∏ APScheduler JobStore (DB 4)

## üîê –°–µ–∫—Ä–µ—Ç—ã –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ

–§–∞–π–ª `.env` —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω —Å–æ —Å–ª–µ–¥—É—é—â–∏–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏:
- `TELEGRAM_BOT_TOKEN` - —Ç–æ–∫–µ–Ω –æ—Ç @BotFather
- `OPENAI_API_KEY` - API –∫–ª—é—á OpenAI
- `POSTGRES_PASSWORD` - –ø–∞—Ä–æ–ª—å –ë–î
- `MIXPANEL_TOKEN` - –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏

**–í–ê–ñ–ù–û:** –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∫–æ–º–º–∏—Ç—å .env –≤ git!

---

## üìû –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

–ö–æ–≥–¥–∞ –Ω–∞—á–∏–Ω–∞–µ—à—å —Ä–∞–±–æ—Ç–∞—Ç—å —Å –ø—Ä–æ–µ–∫—Ç–æ–º:

1. –ó–∞–ø—É—Å—Ç–∏: `docker compose up -d`
2. –ü—Ä–æ–≤–µ—Ä—å —Å—Ç–∞—Ç—É—Å: `docker compose ps` (–≤—Å–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å "Up")
3. –û—Ç–∫—Ä–æ–π –±–æ—Ç–∞ –≤ Telegram –∏ –æ—Ç–ø—Ä–∞–≤—å `/start`
4. –ü—Ä–æ–≤–µ—Ä—å Worker: `curl http://localhost:8005/jobs`
5. –°–æ–∑–¥–∞–π —Ç–µ—Å—Ç–æ–≤—É—é —Ü–µ–ª—å –∏ —Å–æ–±—ã—Ç–∏–µ
6. –ò–∑—É—á–∏ –ª–æ–≥–∏ –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è flow: `docker compose logs -f orchestrator`

–£–¥–∞—á–∏ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ! üöÄ
